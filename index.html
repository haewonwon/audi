<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì•„ìš°ë””ì˜ ì¼ì¼ ì‚°íƒ€ ì²´í—˜</title>

    <link href="https://unpkg.com/maplibre-gl/dist/maplibre-gl.css" rel="stylesheet" />

    <style>
      /* ğŸ¨ ì—°ë§ ì‚°íƒ€ í…Œë§ˆ íŒ”ë ˆíŠ¸ */
      :root {
        --santa-red: #d42426;
        --tree-green: #165b33;
        --snow-white: #ffffff;
        --gold-accent: #f8b229;
        --bg-gradient: linear-gradient(135deg, #165b33 0%, #0f3e23 100%);
      }

      body {
        font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
        background: var(--bg-gradient);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        padding: 20px;
        color: #333;
        overflow: hidden;
        position: relative;
      }

      /* =========================================
           ğŸ§­ ë„¤ë¹„ê²Œì´ì…˜ (ìˆ˜ì •ë¨: ê°„ê²© ë° z-index ì¡°ì •)
        ========================================= */
      .nav-tabs {
        z-index: 20;
        /* margin-bottom ì œê±° */
        background: rgba(255, 255, 255, 0.9);
        padding: 10px;
        border-radius: 50px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        gap: 10px;
        position: relative; /* ì¶”ê°€: ì‚°íƒ€ ëª¨ìì™€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ */
      }

      .nav-link {
        text-decoration: none;
        color: var(--tree-green);
        font-weight: bold;
        padding: 8px 20px;
        border-radius: 30px;
        transition: 0.3s;
      }

      .nav-link.active {
        background: var(--santa-red);
        color: var(--snow-white);
        box-shadow: 0 2px 5px rgba(212, 36, 38, 0.4);
      }

      /* =========================================
           â„ï¸ ì‹¤ì‹œê°„ ëˆˆë‚´ë¦¼ íš¨ê³¼ CSS
        ========================================= */
      #snow-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 0;
      }

      .snowflake {
        position: absolute;
        top: -10px;
        background: var(--snow-white);
        border-radius: 50%;
        opacity: 0.8;
        pointer-events: none;
        animation: fall linear infinite;
      }

      @keyframes fall {
        0% {
          transform: translateY(0) translateX(0);
        }
        100% {
          transform: translateY(105vh) translateX(20px);
        }
      }

      /* =========================================
           ğŸ“¦ ê³µí†µ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ (ìˆ˜ì •ë¨: ê°„ê²© ì¶”ê°€)
        ========================================= */
      .container {
        background: var(--snow-white);
        width: 100%;
        max-width: 400px;
        padding: 2.5rem 2rem 2rem;
        border-radius: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5), 0 0 0 5px var(--santa-red) inset;
        text-align: center;
        position: relative;
        border: 3px solid var(--gold-accent);
        z-index: 10;
        box-sizing: border-box;
        margin-top: 80px; /* ì¶”ê°€: íƒ­ê³¼ ì‚°íƒ€ ëª¨ìê°€ ê²¹ì¹˜ì§€ ì•Šë„ë¡ ê°„ê²© í™•ë³´ */
      }

      /* SPAìš© í˜ì´ì§€ ë˜í¼ */
      .page-section {
        display: none;
        width: 100%;
        display: flex;
        justify-content: center;
      }

      .page-section:not(.active) {
        display: none !important;
      }

      /* ğŸ… ì‚°íƒ€ ëª¨ì ì¥ì‹ (ìˆ˜ì •ë¨: z-index ë‚®ì¶¤) */
      .deco-hat::before {
        content: '';
        position: absolute;
        top: -40px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 30px solid transparent;
        border-right: 30px solid transparent;
        border-bottom: 50px solid var(--santa-red);
        filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.1));
        z-index: -1; /* ì¶”ê°€: íƒ­ ë’¤ë¡œ ê°€ë„ë¡ */
      }
      .deco-hat::after {
        content: '';
        position: absolute;
        top: -50px;
        left: 50%;
        transform: translateX(-50%);
        width: 25px;
        height: 25px;
        background: var(--snow-white);
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: -1; /* ì¶”ê°€: íƒ­ ë’¤ë¡œ ê°€ë„ë¡ */
      }

      h1 {
        color: var(--santa-red);
        font-size: 1.6rem;
        margin-bottom: 0.5rem;
        font-weight: 800;
        text-shadow: 1px 1px 0 var(--gold-accent);
      }
      p {
        color: var(--tree-green);
        font-size: 0.95rem;
        margin-bottom: 1.5rem;
        line-height: 1.6;
        font-weight: 600;
      }
      label {
        display: block;
        text-align: left;
        font-weight: bold;
        margin-bottom: 8px;
        color: var(--tree-green);
        font-size: 0.9rem;
      }
      input,
      select {
        width: 100%;
        padding: 14px;
        margin-bottom: 20px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 1rem;
        box-sizing: border-box;
        transition: 0.3s;
        background: #fcfcfc;
      }
      input:focus,
      select:focus {
        border-color: var(--santa-red);
        box-shadow: 0 0 0 3px rgba(212, 36, 38, 0.2);
        outline: none;
      }
      button {
        width: 100%;
        padding: 16px;
        border: none;
        background: var(--santa-red);
        color: var(--snow-white);
        font-size: 1.1rem;
        font-weight: bold;
        border-radius: 12px;
        cursor: pointer;
        transition: 0.2s;
        box-shadow: 0 4px 0 #a01b1d;
        position: relative;
        top: 0;
      }
      button:hover {
        background: #e63b3d;
      }
      button:active {
        top: 4px;
        box-shadow: 0 0 0 #a01b1d;
      }
      .result-box {
        margin-top: 20px;
        padding: 25px;
        border-radius: 15px;
        background: var(--gold-accent);
        color: var(--santa-red);
        border: 3px dashed var(--santa-red);
        animation: popIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        box-shadow: 0 5px 15px rgba(248, 178, 41, 0.4);
      }
      .result-name {
        font-size: 2.4rem;
        font-weight: 900;
        margin: 15px 0;
        text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.5);
        letter-spacing: -1px;
      }
      .hidden {
        display: none;
      }
      @keyframes popIn {
        from {
          opacity: 0;
          transform: scale(0.5) rotate(-10deg);
        }
        to {
          opacity: 1;
          transform: scale(1) rotate(0deg);
        }
      }
      .btn-back {
        background: var(--tree-green);
        box-shadow: 0 4px 0 #0e3f23;
        margin-top: 10px;
      }
      .btn-back:hover {
        background: #1e7e45;
      }
      .btn-back:active {
        box-shadow: 0 0 0 #0e3f23;
      }

      /* ì§€ë„ ì»¨í…Œì´ë„ˆ ë†’ì´ (ìˆ˜ì •ë¨: ë§ˆë‹ˆë˜ ì°½ê³¼ ë¹„ìŠ·í•˜ê²Œ í†µì¼) */
      #map {
        width: 100%;
        height: 400px; /* ê³ ì • ë†’ì´ë¡œ ë³€ê²½ */
        border-radius: 15px;
        border: 2px solid #ddd;
      }

      /* ë°˜ì‘í˜• (ìˆ˜ì •ë¨: ì§€ë„ ë†’ì´ ê´€ë ¨ ë¯¸ë””ì–´ ì¿¼ë¦¬ ì œê±°) */
      @media (max-width: 767px) {
        body {
          padding: 15px;
        }
        .container {
          max-width: 400px;
          padding: 2rem 1.5rem 1.5rem;
        }
        h1 {
          font-size: 1.4rem;
        }
        .result-name {
          font-size: 2rem;
        }
      }
      @media (min-width: 768px) and (max-width: 1023px) {
        body {
          padding: 30px;
        }
        .container {
          max-width: 500px;
          padding: 3rem 2.5rem 2.5rem;
        }
        .deco-hat::before {
          top: -50px;
          border-width: 0 40px 60px 40px;
        }
        .deco-hat::after {
          top: -60px;
          width: 30px;
          height: 30px;
        }
        h1 {
          font-size: 2rem;
        }
        .result-name {
          font-size: 3rem;
        }
        /* #map { height: ... } <- ì œê±° */
      }
      @media (min-width: 1024px) {
        body {
          padding: 40px;
        }
        .container {
          max-width: 600px;
          padding: 3.5rem 3rem 3rem;
        }
        .deco-hat::before {
          top: -60px;
          border-width: 0 50px 70px 50px;
        }
        .deco-hat::after {
          top: -70px;
          width: 35px;
          height: 35px;
        }
        h1 {
          font-size: 2.4rem;
        }
        .result-name {
          font-size: 3.5rem;
        }
        /* #map { height: 450px; } <- ì œê±° */
      }
    </style>
  </head>
  <body>
    <div id="snow-container"></div>

    <nav class="nav-tabs">
      <a href="#home" class="nav-link active" id="link-home">ğŸ… ë§ˆë‹ˆë˜</a>
      <a href="#map" class="nav-link" id="link-map">ğŸ“ ì˜¤ì‹œëŠ” ê¸¸</a>
    </nav>

    <div id="home-page" class="page-section active">
      <div class="container deco-hat">
        <div id="step-1">
          <h1>ğŸ„ ì•„ìš°ë””ì˜ ì¼ì¼ ì‚°íƒ€ ì²´í—˜ ğŸ…</h1>
          <p>ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥ í›„, ë§ˆë‹ˆë˜ ìƒëŒ€ë¥¼ í™•ì¸í•˜ì„¸ìš”!</p>

          <label for="room-code">ğŸ”‘ ë¹„ë°€ë²ˆí˜¸</label>
          <input
            type="text"
            id="room-code"
            placeholder="ì˜ˆ: ë©”ë¦¬í¬ë¦¬ìŠ¤ë§ˆìŠ¤"
            autocomplete="off"
            style="text-align: center"
          />

          <label for="my-name">ğŸ Who I am?</label>
          <select id="my-name" style="text-align: center; text-align-last: center">
            <option value="" disabled selected>ì´ë¦„ ì„ íƒ</option>
          </select>

          <button onclick="checkResult()">ê²°ê³¼ í™•ì¸</button>
        </div>

        <div id="step-2" class="hidden">
          <h1>ğŸ¤« ì‰¿! ë‹¹ì‹ ì˜ ë§ˆë‹ˆë ëŠ”...</h1>
          <div class="result-box">
            <div style="font-size: 2.5rem">ğŸ</div>
            <div class="result-name" id="target-name">???</div>
            <div style="font-size: 0.9rem; color: #165b33; font-weight: bold">
              (ëª°ë˜ ì¤€ë¹„í•˜ì„¸ìš”!)
            </div>
          </div>
          <p style="margin-top: 20px; color: var(--santa-red)">ì£¼ì˜! ì ˆëŒ€ ë“¤í‚¤ë©´ ì•ˆ ë©ë‹ˆë‹¤...</p>
          <button class="btn-back" onclick="goBack()">ğŸ„ ì²˜ìŒìœ¼ë¡œ</button>
        </div>
      </div>
    </div>

    <div id="map-page" class="page-section">
      <div class="container deco-hat">
        <div id="map"></div>

        <div style="margin-top: 15px; font-size: 0.9rem; color: #555">
          â€» ì§€ë„ë¥¼ í™•ëŒ€/ì¶•ì†Œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/maplibre-gl/dist/maplibre-gl.js"></script>

    <script>
      /* =====================================
         1. ê¸°ì¡´ ë§ˆë‹ˆë˜ ë¡œì§ (ê±´ë“œë¦¬ì§€ ì•ŠìŒ)
         ===================================== */
      const FIXED_PASSWORD = '1227';
      const COUPLES_LIST = [
        ['í•´ì›', 'ì •ì€'],
        ['ë¯¼ì„œ', 'í¬ì£¼'],
        ['ì¬ì´', 'í˜œí˜„'],
      ];

      let participants = [];
      let partnerMap = {};

      (function init() {
        const select = document.getElementById('my-name');
        COUPLES_LIST.forEach((pair) => {
          partnerMap[pair[0]] = pair[1];
          partnerMap[pair[1]] = pair[0];
          participants.push(pair[0]);
          participants.push(pair[1]);
        });
        participants.sort().forEach((name) => {
          const option = document.createElement('option');
          option.value = name;
          option.innerText = name;
          select.appendChild(option);
        });
        setInterval(createSnowflake, 200);
      })();

      function splitmix32(a) {
        return function () {
          a |= 0;
          a = (a + 0x9e3779b9) | 0;
          let t = a ^ (a >>> 16);
          t = Math.imul(t, 0x21f0aaad);
          t = t ^ (t >>> 15);
          t = Math.imul(t, 0x735a2d97);
          return ((t = t ^ (t >>> 15)) >>> 0) / 4294967296;
        };
      }
      function stringToSeed(str) {
        let hash = 1779033703 ^ str.length;
        for (let i = 0; i < str.length; i++)
          (hash = Math.imul(hash ^ str.charCodeAt(i), 3432918353)),
            (hash = (hash << 13) | (hash >>> 19));
        return hash;
      }

      function getMatchList(seedCode) {
        const seed = stringToSeed(seedCode);
        const random = splitmix32(seed);
        let deck = [...participants],
          isValid = false,
          result = {},
          attempt = 0;
        while (!isValid && attempt < 100) {
          isValid = true;
          for (let i = deck.length - 1; i > 0; i--) {
            const j = Math.floor(random() * (i + 1));
            [deck[i], deck[j]] = [deck[j], deck[i]];
          }
          for (let i = 0; i < participants.length; i++) {
            if (participants[i] === deck[i] || partnerMap[participants[i]] === deck[i]) {
              isValid = false;
              break;
            }
            result[participants[i]] = deck[i];
          }
          if (!isValid) random();
          attempt++;
        }
        return result;
      }

      function checkResult() {
        const inputPw = document.getElementById('room-code').value.trim();
        const myName = document.getElementById('my-name').value;

        if (inputPw !== FIXED_PASSWORD) {
          alert('ğŸ… ì•—! ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ì–´ìš”.');
          return;
        }
        if (!myName) {
          alert('ğŸ ë³¸ì¸ì˜ ì´ë¦„ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.');
          return;
        }

        const matches = getMatchList(FIXED_PASSWORD);
        document.getElementById('target-name').innerText = matches[myName];

        document.getElementById('step-1').classList.add('hidden');
        document.getElementById('step-2').classList.remove('hidden');
      }

      function goBack() {
        document.getElementById('step-2').classList.add('hidden');
        document.getElementById('step-1').classList.remove('hidden');
        document.getElementById('target-name').innerText = '???';
        document.getElementById('room-code').value = '';
      }

      function createSnowflake() {
        const snow = document.createElement('div');
        snow.classList.add('snowflake');
        const size = Math.random() * 10 + 5;
        const left = Math.random() * 100;
        const duration = Math.random() * 10 + 5;
        const opacity = Math.random() * 0.6 + 0.4;
        snow.style.width = `${size}px`;
        snow.style.height = `${size}px`;
        snow.style.left = `${left}vw`;
        snow.style.animationDuration = `${duration}s`;
        snow.style.opacity = opacity;
        document.getElementById('snow-container').appendChild(snow);
        setTimeout(() => {
          snow.remove();
        }, duration * 1000);
      }

      /* =====================================
         2. ë¼ìš°í„° ë° ì§€ë„ ë¡œì§
         ===================================== */
      let mapInstance = null;

      // ì„œìš¸ ì‹œì²­ ì¢Œí‘œ (ì›í•˜ëŠ” ì¢Œí‘œë¡œ ìˆ˜ì •í•˜ì„¸ìš”!)
      // [ê²½ë„, ìœ„ë„] ìˆœì„œì…ë‹ˆë‹¤.
      const DESTINATION_COORDS = [126.9072, 37.4906];

      function router() {
        const hash = window.location.hash || '#home';

        document.querySelectorAll('.nav-link').forEach((link) => {
          link.classList.remove('active');
          if (link.getAttribute('href') === hash) {
            link.classList.add('active');
          }
        });

        const homePage = document.getElementById('home-page');
        const mapPage = document.getElementById('map-page');

        if (hash === '#map') {
          homePage.classList.remove('active');
          mapPage.classList.add('active');

          if (!mapInstance) {
            initMap();
          } else {
            setTimeout(() => mapInstance.resize(), 0);
          }
        } else {
          mapPage.classList.remove('active');
          homePage.classList.add('active');
        }
      }

      function initMap() {
        mapInstance = new maplibregl.Map({
          container: 'map',
          style: 'https://tiles.openfreemap.org/styles/liberty',
          center: DESTINATION_COORDS,
          zoom: 14,
        });

        mapInstance.addControl(new maplibregl.NavigationControl());

        new maplibregl.Marker({ color: '#d42426' })
          .setLngLat(DESTINATION_COORDS)
          .setPopup(new maplibregl.Popup({ offset: 25 }).setText('ğŸ„ íŒŒí‹° ì¥ì†Œ!'))
          .addTo(mapInstance);
      }

      window.addEventListener('hashchange', router);
      window.addEventListener('load', router);
    </script>
  </body>
</html>
